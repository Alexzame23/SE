#include <stdio.h>
#include <xil_printf.h>
#include "xil_io.h"

#define PUT_FIFO(val) putfsl(val, 0)  // Escribir en el AXI-Stream

int main() {
    u8 fila, columna, color;
    u32 valor;

    xil_printf("Controlador de VGA - Modificar Rectángulos\n\r");

    while (1) {
        xil_printf("Introduce la fila (0-15): ");
        fila = XUartLite_RecvByte(XPAR_AXI_UARTLITE_0_BASEADDR);
        xil_printf("Received Character: %c\r\n", fila);
        if (fila < 0 || fila > 15) {
            xil_printf("Fila inválida. Debe estar entre 0 y 15.\n\r");
            continue;
        }

        xil_printf("Introduce la columna (0-15): ");
        columna = XUartLite_RecvByte(XPAR_AXI_UARTLITE_0_BASEADDR);
        if (columna < 0 || columna > 15) {
            xil_printf("Columna inválida. Debe estar entre 0 y 15.\n\r");
            continue;
        }

        xil_printf("Introduce el color (0x000-0xFFF): ");
        color = XUartLite_RecvByte(XPAR_AXI_UARTLITE_0_BASEADDR);
        if (color < 0x000 || color > 0xFFF) {
            xil_printf("Color inválido. Debe estar entre 0x000 y 0xFFF.\n\r");
            continue;
        }

        // Codificar el valor
        valor = (columna << 16) | (fila << 12) | color;

        // Enviar al periférico VGA
        PUT_FIFO(valor);

        xil_printf("Rectángulo modificado: Fila=%d, Columna=%d, Color=0x%03X\n\r", fila, columna, color);

        // Opción para salir
        char opcion;
        xil_printf("¿Deseas modificar otro rectángulo? (s/n): ");
        opcion = XUartLite_RecvByte(XPAR_AXI_UARTLITE_0_BASEADDR);
        if (opcion == 'n' || opcion == 'N') {
            xil_printf("Saliendo del programa.\n\r");
            break;
        }
    }

    return 0;
}
